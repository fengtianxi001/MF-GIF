import{r as B,o as _,n as S,d as h,a as k,c as z,w as x,b as L,e as P,u as d,M as T,f as m,g as U,h as $,i as H,j as v,k as V,l as Y,I as q,m as A,p as I,q as b,s as O}from"./index.703b1ac4.js";import{l as i,f as j,c as N,d as G,g as K,u as W,a as X,B as Z,b as J,e as Q,_ as uu,h as eu,i as y,j as tu}from"./BaseTableFilter.267a84e5.js";import{I as au}from"./index.vue_vue_type_style_index_0_lang.001d3e21.js";const su={ZoomIn:"\u653E\u5927",ZoomOut:"\u7F29\u5C0F",Hand:"\u624B\u638C",History:"\u5386\u53F2",Resize:"\u8C03\u6574\u5BBD\u9AD8",Crop:"\u88C1\u526A",DeleteAll:"\u5168\u90E8\u5220\u9664",Delete:"\u5220\u9664",Undo:"\u64A4\u9500",Redo:"\u53CD\u64A4\u9500",Reset:"\u91CD\u7F6E",Flip:"\u955C\u50CF",Rotate:"\u65CB\u8F6C",Draw:"\u753B",Shape:"\u5F62\u72B6\u6807\u6CE8",Icon:"\u56FE\u6807\u6807\u6CE8",Text:"\u6587\u5B57\u6807\u6CE8",Mask:"\u906E\u7F69",Filter:"\u6EE4\u955C",Bold:"\u52A0\u7C97",Italic:"\u659C\u4F53",Underline:"\u4E0B\u5212\u7EBF",Left:"\u5DE6\u5BF9\u9F50",Center:"\u5C45\u4E2D",Right:"\u53F3\u5BF9\u9F50",Color:"\u989C\u8272","Text size":"\u5B57\u4F53\u5927\u5C0F",Custom:"\u81EA\u5B9A\u4E49",Square:"\u6B63\u65B9\u5F62",Apply:"\u5E94\u7528",Cancel:"\u53D6\u6D88","Flip X":"X \u8F74","Flip Y":"Y \u8F74",Range:"\u533A\u95F4",Stroke:"\u63CF\u8FB9",Fill:"\u586B\u5145",Circle:"\u5706",Triangle:"\u4E09\u89D2",Rectangle:"\u77E9\u5F62",Free:"\u66F2\u7EBF",Straight:"\u76F4\u7EBF",Arrow:"\u7BAD\u5934","Arrow-2":"\u7BAD\u59342","Arrow-3":"\u7BAD\u59343","Star-1":"\u661F\u661F1","Star-2":"\u661F\u661F2",Polygon:"\u591A\u8FB9\u5F62",Location:"\u5B9A\u4F4D",Heart:"\u5FC3\u5F62",Bubble:"\u6C14\u6CE1","Custom icon":"\u81EA\u5B9A\u4E49\u56FE\u6807","Load Mask Image":"\u52A0\u8F7D\u8499\u5C42\u56FE\u7247",Grayscale:"\u7070\u5EA6",Blur:"\u6A21\u7CCA",Sharpen:"\u9510\u5316",Emboss:"\u6D6E\u96D5","Remove White":"\u9664\u53BB\u767D\u8272",Distance:"\u8DDD\u79BB",Brightness:"\u4EAE\u5EA6",Noise:"\u566A\u97F3","Color Filter":"\u5F69\u8272\u6EE4\u955C",Sepia:"\u68D5\u8272",Sepia2:"\u68D5\u82722",Invert:"\u8D1F\u7247",Pixelate:"\u50CF\u7D20\u5316",Threshold:"\u9608\u503C",Tint:"\u8272\u8C03",Multiply:"\u6B63\u7247\u53E0\u5E95",Blend:"\u6DF7\u5408\u8272",Width:"\u5BBD\u5EA6",Height:"\u9AD8\u5EA6","Lock Aspect Ratio":"\u9501\u5B9A\u5BBD\u9AD8\u6BD4\u4F8B"};function nu(l,a){const n=B(),o=()=>{n.value=new au(l.value,{includeUI:{loadImage:{path:a,name:"image"},initMenu:"draw",menuBarPosition:"right",locale:su},cssMaxWidth:500,cssMaxHeight:500})},c=()=>{var F;return(F=n.value)==null?void 0:F.toDataURL()};return _(()=>{S(()=>{o()})}),{instance:n,onSave:c}}const ou=h({__name:"index",props:{url:null,resolve:null},setup(l){const a=l,n=B(),{instance:o}=nu(n,a.url),c=B(!0),F=()=>{var r;const E=((r=o.value)==null?void 0:r.toDataURL())||"";a.resolve(E)},C=()=>{a.resolve("")};return(E,r)=>(k(),z(d(T),{visible:c.value,"onUpdate:visible":r[0]||(r[0]=g=>c.value=g),"ok-text":"\u4FDD\u5B58\u5E76\u66FF\u6362","cancel-text":"\u53D6\u6D88\u7F16\u8F91",width:"1000px",class:"base-image-edit-model","unmount-on-close":"",draggable:"","esc-to-close":!1,"mask-closable":!1,onOk:F,onClose:C},{title:x(()=>[L(" \u56FE\u50CF\u7F16\u8F91 ")]),default:x(()=>[P("div",{class:"base-image-edit",ref_key:"container",ref:n},null,512)]),_:1},8,["visible"]))}});function lu(l){return new Promise(a=>{const n=m(ou,{url:l,resolve:a}),o=document.createElement("div");U(n,o);const c=n.el;document.body.appendChild(c)})}function iu(){const l=$([]),a=B([]),n=B({}),o=B([]),c=H(()=>[{label:"\u56FE\u7247\u540D\u79F0",name:"name",component:"Input"},{label:"\u56FE\u7247\u5C3A\u5BF8",name:"size",component:"Select",props:{options:[{label:"\u5927\u56FE\u7247(1M\u4EE5\u4E0A)",value:3},{label:"\u4E2D\u56FE\u7247(500kb-1M)",value:2},{label:"\u5C0F\u56FE\u7247(0kb-500kb)",value:1}]}},{label:"\u56FE\u7247\u7C7B\u578B",name:"type",component:"Select",props:{options:i.exports.uniq(i.exports.map(l,({type:u})=>u))}}]),F=async()=>{const u=await j("image/*"),s=i.exports.map(u,f),e=await Promise.all(s);l.push(...e),v.success(`\u6210\u529F\u5BFC\u5165 ${i.exports.size(e)} \u5F20\u56FE\u7247`),r()},C=async u=>{const s=i.exports.size(u);if(!await N({content:`\u5171 ${s} \u6761\u6570\u636E\uFF0C\u662F\u5426\u79FB\u9664\uFF1F`,okText:"\u786E\u8BA4\u79FB\u9664",cancelText:"\u53D6\u6D88\u64CD\u4F5C"}))return;const t=i.exports.remove(l,({id:p})=>u.includes(p));r(),v.success(`\u6210\u529F\u79FB\u9664 ${i.exports.size(t)} \u5F20\u56FE\u7247`)},E=async u=>{const s=await lu(u.url);if(!s)return;const e=G(s,u.name),t=await f(e);u.url=t.url,u.name=t.name,u.size=t.size,u.type=t.type,u.file=t.file,u.dpi=t.dpi,u.lastModified=t.lastModified},r=()=>{const{name:u,size:s,type:e}=n.value;let t=[...l];u&&(t=t.filter(p=>p.name.toLowerCase().includes(u.toLowerCase()))),e&&(t=l.filter(p=>p.type===e)),o.value=t,a.value=[]},g=u=>{o.value=u},D=async u=>{await K("image",u)},f=async u=>{const s=W(),e=u.name,t=URL.createObjectURL(u),p=u.size,w=u.type,R=await X(t),M=V(u.lastModified).format("YYYY-MM-DD HH:mm:ss");return{id:s,url:t,name:e,size:p,type:w,file:u,dpi:R,lastModified:M}};return{images:l,imageSelected:a,imageFilterParams:n,imageFilterResult:o,imageFilterConfigs:c,onAddImages:F,onRemoveImages:C,onEditImage:E,onFilter:r,onResetFilterResult:g,onConvertImage:D}}const du=h({__name:"index",setup(l){const{imageSelected:a,imageFilterParams:n,imageFilterResult:o,imageFilterConfigs:c,onAddImages:F,onRemoveImages:C,onEditImage:E,onFilter:r,onResetFilterResult:g,onConvertImage:D}=iu(),f=[{title:"\u56FE\u7247\u9884\u89C8",width:90,render:({record:s})=>m(eu,{src:s.url,size:40})},{title:"\u56FE\u7247\u540D\u79F0",dataIndex:"name"},{title:"\u56FE\u7247\u5927\u5C0F",dataIndex:"size"},{title:"\u56FE\u7247\u5206\u8FA8\u7387",dataIndex:"dpi"},{title:"\u56FE\u7247\u7C7B\u578B",dataIndex:"type"},{title:"\u6700\u540E\u7F16\u8F91\u65F6\u95F4",dataIndex:"lastModified"},{title:"\u64CD\u4F5C",width:100,render:({record:s})=>m(tu,{},[m(y,{text:"\u7F16\u8F91",icon:O,size:"small",onClick:()=>E(s)}),m(y,{text:"\u79FB\u9664",color:"danger",icon:A,size:"small",onClick:()=>C([s.id])})])}],u=Y(()=>[[{text:"\u6279\u91CF\u5BFC\u5165",icon:q,click:F},{text:"\u6279\u91CF\u5220\u9664",icon:A,click:()=>{C(a.value)},props:{color:"danger",disabled:a.value.length===0}}],[{text:`\u8F6C\u5316\u9009\u62E9\u9879( ${i.exports.size(a.value)} )`,icon:I,click:()=>{if(i.exports.size(a.value)<2)return v.error("\u8BF7\u81F3\u5C11\u9009\u62E9\u4E24\u5F20\u56FE\u7247");const s=o.value.filter(e=>a.value.includes(e.id));D(s.map(e=>e.url))},props:{disabled:i.exports.size(a.value)<2}},{text:"\u8F6C\u5316\u5F53\u524D\u9875",icon:I,click:async()=>{if(i.exports.size(o.value)<2)return v.error("\u8BF7\u81F3\u5C11\u5BFC\u5165\u4E24\u5F20\u56FE\u7247");const s=o.value.map(e=>e.url);D(s)},props:{disabled:i.exports.size(o.value)===0}}]]);return(s,e)=>(k(),z(Z,{title:"\u56FE\u7247\u8F6CGIF"},{default:x(()=>[m(J,{modelValue:d(n),"onUpdate:modelValue":e[0]||(e[0]=t=>b(n)?n.value=t:null),configs:d(c),query:d(r)},null,8,["modelValue","configs","query"]),m(Q,{list:d(u)},null,8,["list"]),m(uu,{selectedKeys:d(a),"onUpdate:selectedKeys":e[1]||(e[1]=t=>b(a)?a.value=t:null),columns:f,data:d(o),draggable:{type:"handle",width:40},onChange:d(g)},null,8,["selectedKeys","data","onChange"])]),_:1}))}});export{du as default};
