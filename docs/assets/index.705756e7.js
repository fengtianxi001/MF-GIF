import{r as B,bS as x,o as h,n as V,j as C,d as M,a as S,c as I,w as R,b as O,e as D,bT as y,f as c,u as a,bU as k,bV as w,bW as T,q as _,M as L,g as U,h as j,i as $,k as A,l as P,bX as Y,m as E,p as z}from"./index.32878e5a.js";import{m as q,i as g,u as K,l as v,c as N,g as G,B as H,b as W,e as X,_ as J,k as Q,j as Z}from"./BaseTableFilter.6641d827.js";import{v as ee}from"./index.64cf193a.js";function te(i){const t=B("waiting"),s=x([]),n=x(new MediaStream),l=x(),o=document.createElement("video");return o.style.width="100%",h(()=>{V(()=>{i.value.appendChild(o)})}),{data:s,status:t,video:o,onOpenCamera:async()=>{const e={video:!0};n.value=await navigator.mediaDevices.getUserMedia(e),o.srcObject=n.value,o.controls=!1,o.play()},onCloseCamera:()=>{n.value.getTracks().forEach(e=>e.stop())},onStartRecorder:async()=>{C.success("\u5F55\u50CF\u4E2D,\u8BB0\u5F97\u4FDD\u6301\u5FAE\u7B11\u54E6"),o.srcObject=n.value,o.controls=!1,o.play(),s.value=[],t.value="recording",l.value=new MediaRecorder(n.value,{mimeType:"video/webm"}),l.value.start(),l.value.addEventListener("dataavailable",e=>s.value.push(e.data)),l.value.addEventListener("stop",()=>{o.srcObject=null,o.src=URL.createObjectURL(new Blob(s.value)),o.play(),o.controls=!0})},onStopRecorder:()=>{var e;t.value="end",(e=l.value)==null||e.stop()}}}const oe={class:"base-camera-operate"},ae=M({__name:"index",props:{resolve:null},setup(i){const t=i,{visible:s}=q(!0),n=B(),{status:l,data:o,onOpenCamera:m,onCloseCamera:F,onStartRecorder:p,onStopRecorder:f}=te(n),e=()=>l.value==="recording"?(C.error("\u8BF7\u5148\u505C\u6B62\u5F55\u50CF"),!1):l.value==="waiting"?(C.error("\u8BF7\u5148\u5F00\u59CB\u5F55\u50CF"),!1):(t.resolve(new Blob(o.value)),!0);return h(()=>{m()}),(b,r)=>(S(),I(a(L),{class:"base-camera-model",visible:a(s),"onUpdate:visible":r[0]||(r[0]=u=>_(s)?s.value=u:null),"ok-text":"\u4FDD\u5B58\u5F55\u50CF","cancel-text":"\u53D6\u6D88",width:"700px","unmount-on-close":"",draggable:"","on-before-ok":e,onBeforeClose:a(F)},{title:R(()=>[O(" \u6444\u50CF\u5934\u5F55\u5236 ")]),default:R(()=>[D("div",{class:"base-camera-body",ref_key:"container",ref:n},[D("div",oe,[y(c(g,{text:"\u5F00\u59CB\u5F55\u5236",size:"small",color:"primary",icon:a(k),onClick:a(p)},null,8,["icon","onClick"]),[[w,a(l)==="waiting"]]),y(c(g,{text:"\u91CD\u65B0\u5F55\u5236",size:"small",color:"primary",icon:a(k),onClick:a(p)},null,8,["icon","onClick"]),[[w,a(l)==="end"]]),y(c(g,{text:"\u505C\u6B62\u5F55\u5236",size:"small",color:"danger",icon:a(T),onClick:a(f)},null,8,["icon","onClick"]),[[w,a(l)==="recording"]])])],512)]),_:1},8,["visible","onBeforeClose"]))}});function ue(){return new Promise(i=>{const t=c(ae,{resolve:i}),s=document.createElement("div");U(t,s);const n=t.el;document.body.appendChild(n)})}function se(){const i=j([]),t=B([]),s=B({}),n=B([]),l=$(()=>[{label:"\u5F55\u50CF\u540D\u79F0",name:"name",component:"Input"},{label:"\u5F55\u50CF\u65F6\u957F",name:"size",component:"Select",props:{options:[]}}]),o=async()=>{const e=await ue();i.push({id:K(),url:URL.createObjectURL(e),name:"\u5F55\u50CF"+new Date().getTime(),size:e.size,type:e.type,lastModified:A().format("YYYY-MM-DD HH:mm:ss")}),F(),C.success("\u5F55\u50CF\u5BFC\u5165\u6210\u529F")},m=async e=>{const b=v.exports.size(e);if(!await N({content:`\u5171 ${b} \u6761\u6570\u636E\uFF0C\u662F\u5426\u79FB\u9664\uFF1F`,okText:"\u786E\u8BA4\u79FB\u9664",cancelText:"\u53D6\u6D88\u64CD\u4F5C"}))return;const u=v.exports.remove(i,({id:d})=>e.includes(d));F(),C.success(`\u6210\u529F\u79FB\u9664 ${v.exports.size(u)} \u5F20\u56FE\u7247`)},F=()=>{const{name:e,size:b,type:r}=s.value;let u=[...i];e&&(u=u.filter(d=>d.name.toLowerCase().includes(e.toLowerCase()))),r&&(u=u.filter(d=>d.type.includes(r))),n.value=u,t.value=[]};return{videos:i,videoSelected:t,videoFilterParams:s,videoFilterResult:n,videoFilterConfigs:l,onCamera:o,onRemoveVideos:m,onFilter:F,onResetFilterResult:e=>{n.value=e},onConvertImage:async e=>{await G("video",e)}}}const ie=M({__name:"index",setup(i){const{videoSelected:t,videoFilterParams:s,videoFilterResult:n,videoFilterConfigs:l,onCamera:o,onRemoveVideos:m,onFilter:F,onResetFilterResult:p,onConvertImage:f}=se(),e=[{title:"\u5F55\u50CF\u540D\u79F0",dataIndex:"name"},{title:"\u5F55\u50CF\u5927\u5C0F",render:({record:r})=>Q(r.size)},{title:"\u6700\u540E\u7F16\u8F91\u65F6\u95F4",dataIndex:"lastModified"},{title:"\u64CD\u4F5C",width:100,render:({record:r})=>c(Z,{},[c(g,{text:"\u64AD\u653E",icon:z,size:"small",onClick:()=>{ee(r.url)}}),c(g,{text:"\u79FB\u9664",color:"danger",icon:E,size:"small",onClick:()=>m([r.id])})])}],b=P(()=>[[{text:"\u5F00\u59CB\u5F55\u50CF",icon:Y,click:o},{text:"\u6279\u91CF\u79FB\u9664",icon:E,click:()=>{m(t.value)},props:{color:"danger",disabled:v.exports.size(t.value)===0}}],[{text:`\u8F6C\u5316\u9009\u62E9\u9879( ${v.exports.size(t.value)} )`,icon:z,click:()=>{if(v.exports.size(t.value)>1)return C.error("\u4E00\u6B21\u53EA\u80FD\u9009\u62E9\u8F6C\u6362\u4E00\u4E2A\u89C6\u9891\u6587\u4EF6");const r=n.value.filter(u=>t.value.includes(u.id));f(r.map(u=>u.url))},props:{disabled:v.exports.size(t.value)<1}}]]);return(r,u)=>(S(),I(H,{title:"\u5F55\u50CF\u8F6CGIF"},{default:R(()=>[c(W,{modelValue:a(s),"onUpdate:modelValue":u[0]||(u[0]=d=>_(s)?s.value=d:null),configs:a(l),query:a(F)},null,8,["modelValue","configs","query"]),c(X,{list:a(b)},null,8,["list"]),c(J,{selectedKeys:a(t),"onUpdate:selectedKeys":u[1]||(u[1]=d=>_(t)?t.value=d:null),columns:e,data:a(n),draggable:{type:"handle",width:40},onChange:a(p)},null,8,["selectedKeys","data","onChange"])]),_:1}))}});export{ie as default};
